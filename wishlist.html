<!-- wishlist.html -->
<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SetHub Wishlist</title>
  <meta name="description" content="SetHub Wishlist" />
  <meta name="theme-color" content="#0E141A" />
  <link rel="icon" type="image/png" href="Bilder/lagos.png" />

  <style>
    :root{
      --bg:#0E141A;
      --fg:#E6E9ED;
      --muted:#9AA4AE;

      --shadow2:0 10px 30px rgba(0,0,0,.45);

      --r3:23px;

      --pink:#cf64e5;
      --cyan:#00E5FF;

      --good:rgba(0,229,255,.35);
      --sale:rgba(207,100,229,.55);
    }

    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      color:var(--fg);
      background:var(--bg);
      overflow-x:hidden;
      min-height:100vh;
    }
    img{max-width:100%;display:block;height:auto}
    a{color:inherit;text-decoration:none}
    button,input,select{font:inherit}

    header.site{
      position:fixed;
      left:0; right:0; top:0;
      height:78px;
      background:rgba(16,24,32,.65);
      backdrop-filter:blur(10px);
      border-bottom:1px solid rgba(255,255,255,.06);
      z-index:50;
    }

    .topbar-inner{
      height:100%;
      width:min(1240px,100%);
      margin:0 auto;
      padding:0 14px;
      display:grid;
      grid-template-columns:56px 1fr 56px;
      align-items:center;
    }

    .nav-brand{
      grid-column:2;
      justify-self:center;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:.6rem;
      min-width:0;
      transform:translateY(4px);
    }
    .logo-svg{width:100%;height:100%;display:block}
    .nav-logo{
      height:48px;
      width:auto;
      display:grid;
      place-items:center;
      transform:translateY(10px);
      flex:0 0 auto;
    }
    .nav-text{
      display:flex;
      align-items:center;
      gap:.15em;
      line-height:1;
      font-weight:900;
      letter-spacing:.04em;
      color:#fff;
      font-size:1.6rem;
      white-space:nowrap;
    }

    .burger{
      position:fixed;
      top:16px;
      left:14px;
      z-index:60;
      width:46px;
      height:46px;
      border-radius:12px;
      background:rgba(16,24,32,.7);
      border:1px solid rgba(255,255,255,.10);
      backdrop-filter:blur(10px);
      display:grid;
      place-items:center;
      cursor:pointer;
      transition:transform .12s ease, filter .12s ease;
    }
    .burger:hover{transform:translateY(-1px);filter:brightness(1.06)}
    .burger .lines{width:20px;height:14px;position:relative}
    .burger .lines span{
      position:absolute;left:0;right:0;
      height:2px;background:#e8eef4;border-radius:2px;
      transition:transform .25s ease, opacity .2s ease, top .25s ease;
    }
    .burger .lines span:nth-child(1){top:0}
    .burger .lines span:nth-child(2){top:6px}
    .burger .lines span:nth-child(3){top:12px}
    body.drawer-open .burger .lines span:nth-child(1){top:6px;transform:rotate(45deg)}
    body.drawer-open .burger .lines span:nth-child(2){opacity:0}
    body.drawer-open .burger .lines span:nth-child(3){top:6px;transform:rotate(-45deg)}

    .top-links{
      position:fixed;
      top:16px;
      left:68px;
      right:140px;
      z-index:59;
      display:flex;
      gap:10px;
      align-items:center;
    }
    .top-link{
      height:46px;
      padding:0 14px;
      border-radius:12px;
      background:rgba(16,24,32,.7);
      border:1px solid rgba(255,255,255,.10);
      backdrop-filter:blur(10px);
      display:flex;
      align-items:center;
      gap:10px;
      cursor:pointer;
      user-select:none;
      font-weight:800;
      color:#fff;
      letter-spacing:.02em;
      white-space:nowrap;
    }
    .top-link:hover{background:rgba(19,32,42,.85)}
    .top-link span{color:#b7c2cc;font-weight:700}

    .top-icons{
      position:fixed;
      top:16px;
      right:14px;
      z-index:59;
      display:flex;
      gap:10px;
      align-items:center;
    }

    .top-ic{
      height:46px;
      width:46px;
      border-radius:12px;
      background:rgba(16,24,32,.7);
      border:1px solid rgba(255,255,255,.10);
      backdrop-filter:blur(10px);
      display:grid;
      place-items:center;
      cursor:pointer;
      position:relative;
    }
    .top-ic:hover{background:rgba(19,32,42,.85)}
    .top-ic svg{width:20px;height:20px;color:#fff}

    .badgecount{
      position:absolute;
      right:-6px;
      top:-6px;
      min-width:20px;
      height:20px;
      padding:0 6px;
      border-radius:999px;
      background:rgba(207,100,229,.95);
      color:#fff;
      font-weight:900;
      font-size:.78rem;
      display:flex;
      align-items:center;
      justify-content:center;
      border:1px solid rgba(255,255,255,.12);
      box-shadow:0 10px 24px rgba(0,0,0,.45);
    }

    @media (max-width:720px){
      header.site{height:72px}
      .nav-logo{height:44px}
      .nav-text{font-size:1.45rem}
      .burger{width:44px;height:44px;top:14px}
      .top-links{top:14px;left:64px;right:118px;gap:8px}
      .top-link{height:44px;padding:0 12px}
      .top-link span{display:none}
      .top-icons{top:14px;right:14px;gap:8px}
      .top-ic{height:44px;width:44px}
    }
    @media (max-width:520px){
      .top-links{display:none}
      .top-icons{display:flex}
    }

    .drawer{
      position:fixed;
      top:0; left:0; bottom:0;
      width:min(320px,86vw);
      background:rgba(12,18,24,.98);
      border-right:1px solid rgba(255,255,255,.08);
      z-index:58;
      transform:translateX(-100%);
      transition:transform .32s ease;
      display:flex;
      flex-direction:column;
      padding:90px 18px 18px;
      gap:10px;
    }
    body.drawer-open .drawer{transform:translateX(0)}
    .drawer a, .drawer button.drawer-link{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:14px 14px;
      border-radius:12px;
      background:#0f1820;
      border:1px solid rgba(255,255,255,.10);
      font-weight:700;
      letter-spacing:.02em;
      cursor:pointer;
      color:inherit;
    }
    .drawer a:hover, .drawer button.drawer-link:hover{background:#13202a}
    .drawer small{color:#94a3b8;font-weight:600}
    .drawer button.drawer-link{appearance:none;width:100%;text-align:left}

    .drawer-backdrop{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.45);
      z-index:57;
      opacity:0;
      pointer-events:none;
      transition:opacity .25s ease;
    }
    body.drawer-open .drawer-backdrop{opacity:1;pointer-events:auto}

    main{
      padding:92px 5% 60px;
      width:min(1240px,100%);
      margin:0 auto;
    }
    @media (max-width:720px){ main{padding-top:84px} }
    @media (max-width:420px){ main{padding-inline:4%} }

    .panel{
      border-radius:var(--r3);
      background:
        radial-gradient(1200px 700px at 72% 22%, rgba(236,72,153,.20), transparent 70%),
        radial-gradient(1100px 650px at 78% 82%, rgba(59,130,246,.16), transparent 65%),
        rgba(15,22,30,.68);
      border:1px solid rgba(255,255,255,.08);
      box-shadow:0 26px 90px rgba(0,0,0,.55);
      padding:clamp(14px,2.2vw,20px);
    }

    .head{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
      margin-bottom:12px;
    }
    .tblock{min-width:240px}
    .title{
      font-weight:900;
      font-size:clamp(2rem,3.4vw,2.7rem);
      letter-spacing:.01em;
      line-height:1.05;
    }
    .sub{
      margin-top:8px;
      color:#cfd6dd;
      font-weight:800;
      letter-spacing:.14em;
      text-transform:uppercase;
      font-size:.85rem;
      opacity:.95;
    }

    .btnrow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:10px;
    }

    .btn{
      height:46px;
      border-radius:14px;
      border:1px solid rgba(207,100,229,.65);
      background:linear-gradient(180deg,#7a3bd0,#572B87);
      color:#fff;
      font-weight:900;
      cursor:pointer;
      padding:0 14px;
      transition:transform .12s ease, filter .12s ease;
    }
    .btn:hover{transform:translateY(-1px);filter:brightness(1.06)}

    .btn2{
      height:46px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(16,24,32,.35);
      color:#fff;
      font-weight:900;
      cursor:pointer;
      padding:0 14px;
      transition:transform .12s ease, filter .12s ease;
    }
    .btn2:hover{transform:translateY(-1px);filter:brightness(1.06)}

    .grid{
      display:grid;
      gap:12px;
      grid-template-columns:repeat(2,minmax(0,1fr));
      margin-top:14px;
    }
    @media (min-width:700px){ .grid{grid-template-columns:repeat(3,minmax(0,1fr))} }
    @media (min-width:1100px){ .grid{grid-template-columns:repeat(5,minmax(0,1fr))} }

    .card{
      position:relative;
      border-radius:18px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.08);
      background:linear-gradient(180deg,#101820,#0b1218);
      box-shadow:var(--shadow2);
      cursor:pointer;
      transition:transform .15s ease, border-color .15s ease, filter .15s ease;
      display:flex;
      flex-direction:column;
      outline:none;
    }
    .card:hover{transform:translateY(-2px);border-color:rgba(255,255,255,.16);filter:brightness(1.03)}
    .card.expanded{border-color:rgba(0,229,255,.22)}

    .thumb{
      position:relative;
      aspect-ratio:1/1;
      background:#0b1218;
      border-bottom:1px solid rgba(255,255,255,.08);
    }
    .thumb img{width:100%;height:100%;object-fit:cover}

    .remove{
      position:absolute;
      right:10px;
      top:10px;
      height:42px;
      width:42px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(16,24,32,.45);
      display:grid;
      place-items:center;
      cursor:pointer;
      z-index:3;
      color:#fff;
      font-weight:900;
    }

    .badge{
      position:absolute;
      left:10px;
      top:10px;
      height:28px;
      padding:0 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(16,24,32,.55);
      display:flex;
      align-items:center;
      gap:8px;
      font-weight:900;
      letter-spacing:.02em;
      user-select:none;
      backdrop-filter:blur(8px);
      z-index:2;
    }
    .badge .bsub{color:var(--muted);font-weight:850}
    .badge.sale{border-color:var(--sale)}
    .badge.best{border-color:var(--good)}

    .body{
      padding:12px 10px 12px;
      display:flex;
      flex-direction:column;
      gap:10px;
      flex:1;
    }

    .name{
      font-weight:900;
      font-size:.98rem;
      line-height:1.25;
      display:-webkit-box;
      -webkit-line-clamp:2;
      -webkit-box-orient:vertical;
      overflow:hidden;
      min-height:2.5em;
      text-align:center;
      padding:0 2px;
    }

    .topline{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      padding:0 6px;
    }

    .setno{
      color:var(--muted);
      font-weight:900;
      letter-spacing:.08em;
      text-transform:uppercase;
      font-size:.78rem;
      white-space:nowrap;
    }

    .pricebox{
      display:flex;
      align-items:baseline;
      gap:8px;
      white-space:nowrap;
      justify-content:flex-end;
    }
    .price{
      font-weight:900;
      font-size:1.12rem;
      letter-spacing:.01em;
      white-space:nowrap;
    }
    .oldprice{
      color:var(--muted);
      font-weight:900;
      text-decoration:line-through;
      font-size:.9rem;
      white-space:nowrap;
    }
    .pctpill{
      height:22px;
      padding:0 8px;
      border-radius:999px;
      border:1px solid rgba(207,100,229,.55);
      background:rgba(207,100,229,.10);
      color:#f2c9ff;
      display:flex;
      align-items:center;
      font-weight:900;
      font-size:.78rem;
      white-space:nowrap;
    }

    .toggle{
      margin-top:auto;
      height:42px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(16,24,32,.40);
      color:#fff;
      font-weight:900;
      cursor:pointer;
      width:100%;
      transition:transform .12s ease, filter .12s ease, border-color .12s ease;
    }
    .toggle:hover{transform:translateY(-1px);filter:brightness(1.06)}
    .card.expanded .toggle{display:none}

    .details{
      overflow:visible;
      max-height:0;
      opacity:0;
      transform:translateY(-4px);
      transition:max-height .28s ease, opacity .18s ease, transform .18s ease, padding .18s ease;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(16,24,32,.22);
      padding:0;
    }
    .card.expanded .details{
      max-height:1600px;
      opacity:1;
      transform:translateY(0);
      padding:10px;
    }

    .stores{
      display:grid;
      gap:10px;
    }

    .store-btn{
      width:100%;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(16,24,32,.30);
      border-radius:14px;
      padding:10px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      cursor:pointer;
      color:#fff;
      font-weight:900;
      transition:transform .12s ease, filter .12s ease, border-color .12s ease;
      text-align:left;
    }
    .store-btn:hover{filter:brightness(1.06);transform:translateY(-1px)}
    .store-btn.primary{border-color:rgba(0,229,255,.26)}

    .store-right{
      display:flex;
      align-items:center;
      gap:10px;
      white-space:nowrap;
    }

    .store-old{
      color:var(--muted);
      font-weight:850;
      text-decoration:line-through;
      font-size:.88rem;
    }
    .store-pct{
      height:22px;
      padding:0 8px;
      border-radius:999px;
      border:1px solid rgba(207,100,229,.55);
      background:rgba(207,100,229,.10);
      color:#f2c9ff;
      display:flex;
      align-items:center;
      font-weight:900;
      font-size:.78rem;
    }

    .empty{
      margin-top:14px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(16,24,32,.35);
      border-radius:18px;
      padding:14px;
      color:#cfd6dd;
      font-weight:850;
      line-height:1.5;
      text-align:center;
    }
  </style>
</head>

<body>
  <button class="burger" id="burgerBtn" aria-label="Menü öffnen" type="button">
    <div class="lines" aria-hidden="true">
      <span></span><span></span><span></span>
    </div>
  </button>

  <div class="top-links" aria-label="Quick Links">
    <a class="top-link" href="/sale.html" aria-label="Sale">
      <strong>Sale</strong><span>Deals</span>
    </a>
    <a class="top-link" href="/news.html" aria-label="News">
      <strong>News</strong><span>Updates</span>
    </a>
    <a class="top-link" href="/events.html" aria-label="Events">
      <strong>Events</strong><span>Dates</span>
    </a>
  </div>

  <div class="top-icons" aria-label="Icons">
    <a class="top-ic" href="/wishlist.html" aria-label="Wishlist">
      <svg viewBox="0 0 24 24" aria-hidden="true">
        <path d="M12 21s-7-4.6-9.3-9C1.3 9 3.2 6 6.5 6c1.9 0 3.2 1 3.9 2c.7-1 2-2 3.9-2C17.6 6 19.5 9 21.3 12c-2.3 4.4-9.3 9-9.3 9Z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
      </svg>
      <div class="badgecount" id="wishBadge" hidden>0</div>
    </a>

    <button class="top-ic" id="loginOpenTop" type="button" aria-label="Anmelden">
      <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
        <path d="M12 12a4 4 0 1 0-4-4a4 4 0 0 0 4 4Z" stroke="currentColor" stroke-width="2"/>
        <path d="M4 20c1.6-3.4 5-5 8-5s6.4 1.6 8 5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
    </button>
  </div>

  <nav class="drawer" id="drawer" aria-label="Menü">
    <a href="/index.html" class="drawer-link">Homepage <small>Start</small></a>
    <a href="/sale.html" class="drawer-link">Sale <small>Deals</small></a>
    <a href="/news.html" class="drawer-link">News <small>Updates</small></a>
    <a href="/events.html" class="drawer-link">Events <small>Dates</small></a>
    <a href="/newsets.html" class="drawer-link">New-Sets <small>New-Sets</small></a>
    <a href="/wishlist.html" class="drawer-link">Wishlist <small>Saved</small></a>
    <a href="#impressum" class="drawer-link">Impressum <small>Legal</small></a>
    <button class="drawer-link" id="loginOpenDrawer" type="button">Anmelden <small>Google</small></button>
  </nav>
  <div class="drawer-backdrop" id="drawerBackdrop" aria-hidden="true"></div>

  <svg width="0" height="0" style="position:absolute;left:-9999px;top:-9999px" aria-hidden="true" focusable="false">
    <symbol id="sethub-logo" viewBox="0 0 3326 2408" preserveAspectRatio="xMidYMid meet">
      <defs>
        <g id="logo-geometry">
          <g id="Ebene_3">
            <path fill="#04d5eb" fill-rule="evenodd" d="M1421.54,318.24c22.25,62.73,139.85,77.99,200.88,77.76,17.07-.06,161.51-2.01,187.92-71.28,7.3-19.15,6.91-46.93,6.48-77.76-.45-31.95-.57-47.96-5.79-61.91-24.90-66.46-125.71-83.15-149.73-87.13-16.28-2.7-49.47-6.70-90.72,0-27.93,4.54-123.89,20.12-149.04,84.24-6.27,16-6.23,32.31-6.48,64.80-.17,22.34-.39,51.90,6.48,71.28ZM1434.5,208.08c0-48.05,91.62-90.72,184.74-90.72s178.14,42.67,178.14,90.72-91.62,97.20-184.74,97.20-178.14-49.15-178.14-97.20Z"></path>
            <path fill="#04d5eb" fill-rule="evenodd" d="M1826.54,534.24c22.25,62.73,139.85,77.99,200.88,77.76,17.07-.06,161.51-2.01,187.92-71.28,7.30-19.15,6.91-46.93,6.48-77.76-.45-31.95-.57-47.96-5.79-61.91-24.90-66.46-125.71-83.15-149.73-87.13-16.28-2.70-49.47-6.70-90.72,0-27.93,4.54-123.89,20.12-149.04,84.24-6.27,16-6.23,32.31-6.48,64.80-.17,22.34-.39,51.90,6.48,71.28ZM1839.5,424.08c0-48.05,91.62-90.72,184.74-90.72s178.14,42.67,178.14,90.72-91.62,97.20-184.74,97.20-178.14-49.15-178.14-97.20Z"></path>
            <path fill="#04d5eb" fill-rule="evenodd" d="M1421.54,799.99c22.25,62.73,139.85,77.99,200.88,77.76,17.07-.06,161.51-2.01,187.92-71.28,7.30-19.15,6.91-46.93,6.48-77.76-.45-31.95-.57-47.96-5.79-61.91-24.90-66.46-125.71-83.15-149.73-87.13-16.28-2.70-49.47-6.70-90.72,0-27.93,4.54-123.89,20.12-149.04,84.24-6.27,16-6.23,32.31-6.48,64.80-.17,22.34-.39,51.90,6.48,71.28ZM1434.5,689.83c0-48.05,91.62-90.72,184.74-90.72s178.14,42.67,178.14,90.72-91.62,97.20-184.74,97.20-178.14-49.15-178.14-97.20Z"></path>
            <path fill="#04d5eb" fill-rule="evenodd" d="M1019.52,534.24c22.25,62.73,139.85,77.99,200.88,77.76,17.07-.06,161.51-2.01,187.92-71.28,7.30-19.15,6.91-46.93,6.48-77.76-.45-31.95-.57-47.96-5.79-61.91-24.90-66.46-125.71-83.15-149.73-87.13-16.28-2.70-49.47-6.70-90.72,0-27.93,4.54-123.89,20.12-149.04,84.24-6.27,16-6.23,32.31-6.48,64.80-.17,22.34-.39,51.90,6.48,71.28ZM1032.48,424.08c0-48.05,91.62-90.72,184.74-90.72s178.14,42.67,178.14,90.72-91.62,97.20-184.74,97.20-178.14-49.15-178.14-97.20Z"></path>
          </g>
          <g id="Ebene_5">
            <path fill="#04d5eb" d="M1586,1605l-765-450v-585l765,459v576Z"></path>
            <path fill="#04d5eb" d="M1640,1605l765-450v-585l-765,459v576Z"></path>
          </g>
        </g>

        <mask id="logoMask" maskUnits="userSpaceOnUse" x="0" y="0" width="3326" height="2408">
          <use href="#logo-geometry"></use>
        </mask>

        <linearGradient id="gradA" x1="-20%" y1="0%" x2="120%" y2="0%" spreadMethod="reflect">
          <stop offset="0%">
            <animate attributeName="stop-color" dur="12s" repeatCount="indefinite"
              values="#00E5FF; #FF5EA0; #FFD300; #00FF87; #00E5FF"></animate>
          </stop>
          <stop offset="50%">
            <animate attributeName="stop-color" dur="12s" repeatCount="indefinite"
              values="#7A5CFF; #00FF87; #FF5EA0; #00E5FF; #7A5CFF"></animate>
          </stop>
          <stop offset="100%">
            <animate attributeName="stop-color" dur="12s" repeatCount="indefinite"
              values="#FF5EA0; #FFD300; #00E5FF; #7A5CFF; #FF5EA0"></animate>
          </stop>
          <animateTransform attributeName="gradientTransform" type="translate" dur="12s"
            repeatCount="indefinite" values="-0.4 0; 0.4 0; -0.4 0"></animateTransform>
        </linearGradient>
      </defs>

      <g mask="url(#logoMask)">
        <rect x="0" y="0" width="3326" height="2408" fill="url(#gradA)"></rect>
      </g>
    </symbol>
  </svg>

  <header class="site" aria-label="Navigation">
    <div class="topbar-inner">
      <div class="nav-brand">
        <div class="nav-logo" aria-hidden="true">
          <svg class="logo-svg" viewBox="0 0 3326 2408" preserveAspectRatio="xMidYMid meet">
            <use href="#sethub-logo"></use>
          </svg>
        </div>
        <div class="nav-text" aria-label="SetHub">
          <span>S</span><span>e</span><span>t</span><span>H</span><span>u</span><span>b</span>
        </div>
      </div>
    </div>
  </header>

  <main>
    <div class="panel">
      <div class="head">
        <div class="tblock">
          <div class="title">Wishlist</div>
          <div class="sub">Gespeichert lokal</div>
        </div>
      </div>

      <div class="btnrow">
        <button class="btn2" id="backBtn" type="button">Zurück zu Sale</button>
        <button class="btn" id="clearBtn" type="button">Alles löschen</button>
      </div>

      <div class="grid" id="grid" aria-label="Wishlist Sets"></div>

      <div class="empty" id="empty" hidden>Keine gespeicherten Sets</div>
    </div>
  </main>

  <script>
    const FALLBACK_IMG = "/Bilder/real1.png"
    const LS_WISH_KEYS = "sethub_wishlist"
    const LS_WISH_ITEMS = "sethub_wishlist_items"

    const els = {
      burgerBtn: document.getElementById("burgerBtn"),
      drawerBackdrop: document.getElementById("drawerBackdrop"),
      grid: document.getElementById("grid"),
      empty: document.getElementById("empty"),
      wishBadge: document.getElementById("wishBadge"),
      backBtn: document.getElementById("backBtn"),
      clearBtn: document.getElementById("clearBtn"),
      loginOpenTop: document.getElementById("loginOpenTop"),
      loginOpenDrawer: document.getElementById("loginOpenDrawer")
    }

    function openDrawer(){ document.body.classList.add("drawer-open") }
    function closeDrawer(){ document.body.classList.remove("drawer-open") }

    if(els.burgerBtn){
      els.burgerBtn.addEventListener("click", () => {
        if(document.body.classList.contains("drawer-open")) closeDrawer()
        else openDrawer()
      })
    }
    if(els.drawerBackdrop) els.drawerBackdrop.addEventListener("click", closeDrawer)
    document.querySelectorAll(".drawer-link").forEach(a => a.addEventListener("click", closeDrawer))
    addEventListener("keydown", e => { if(e.key === "Escape") closeDrawer() })

    if(els.loginOpenTop && els.loginOpenDrawer){
      els.loginOpenTop.addEventListener("click", () => {
        closeDrawer()
        els.loginOpenDrawer.click()
      })
    }

    function loadKeys(){
      try{
        const x = JSON.parse(localStorage.getItem(LS_WISH_KEYS) || "[]")
        if(Array.isArray(x)) return new Set(x.map(String))
        return new Set()
      }catch{
        return new Set()
      }
    }

    function loadItems(){
      try{
        const x = JSON.parse(localStorage.getItem(LS_WISH_ITEMS) || "{}")
        if(x && typeof x === "object") return x
        return {}
      }catch{
        return {}
      }
    }

    function save(keys, items){
      localStorage.setItem(LS_WISH_KEYS, JSON.stringify([...keys]))
      localStorage.setItem(LS_WISH_ITEMS, JSON.stringify(items))
    }

    function updateBadge(keys){
      const n = keys.size
      if(els.wishBadge){
        els.wishBadge.textContent = String(n)
        els.wishBadge.hidden = n <= 0
      }
    }

    function formatEUR(n){
      try{
        return new Intl.NumberFormat("de-DE", { style:"currency", currency:"EUR" }).format(n)
      }catch{
        return (Math.round(n * 100) / 100).toFixed(2) + " €"
      }
    }

    function escapeHtml(str){
      const s = String(str ?? "")
      return s
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;")
    }

    function topBadgeHtml(x){
      if(x.bestSale && Number.isFinite(x.bestSale.pct)){
        return "<div class=\"badge sale\"><span>Sale</span><span class=\"bsub\">" + escapeHtml(String(x.bestSale.pct)) + "%</span></div>"
      }
      if(x.best && Number.isFinite(x.best.price)){
        const src = x.best.source || ""
        const label = src === "lego" ? "LEGO" : (src === "amazon" ? "Amazon" : "Alternate")
        return "<div class=\"badge best\"><span>Best</span><span class=\"bsub\">" + escapeHtml(label) + "</span></div>"
      }
      return ""
    }

    function storeBtnHtml(label, s, primary){
      if(!s || !s.url || !Number.isFinite(s.price)) return ""
      const cls = "store-btn" + (primary ? " primary" : "")
      const oldTxt = Number.isFinite(s.oldPrice) ? formatEUR(s.oldPrice) : ""
      const pct = Number.isFinite(s.discountPct) ? s.discountPct : null

      return "<button class=\"" + cls + "\" type=\"button\" data-url=\"" + escapeHtml(s.url) + "\">" +
        "<div>" + escapeHtml(label) + "</div>" +
        "<div class=\"store-right\">" +
          "<div>" + escapeHtml(formatEUR(s.price)) + "</div>" +
          (oldTxt ? "<div class=\"store-old\">" + escapeHtml(oldTxt) + "</div>" : "") +
          (pct ? "<div class=\"store-pct\">" + escapeHtml(String(pct)) + "%</div>" : "") +
        "</div>" +
      "</button>"
    }

    function render(){
      const keys = loadKeys()
      const items = loadItems()

      updateBadge(keys)

      const list = [...keys]
        .map(k => items[k])
        .filter(Boolean)
        .sort((a,b) => (b.savedAt || 0) - (a.savedAt || 0))

      els.grid.innerHTML = ""
      els.empty.hidden = list.length !== 0

      for(const x of list){
        const name = x.name || "Set"
        const img = x.image || FALLBACK_IMG
        const setNumber = x.setNumber || ""

        const bestPrice = x.best && Number.isFinite(x.best.price) ? x.best.price : null
        const priceTxt = bestPrice !== null ? formatEUR(bestPrice) : "-"

        const bestSource = x.best ? x.best.source : null
        const bestOld = bestSource && x.sources && x.sources[bestSource] ? x.sources[bestSource].oldPrice : null
        const oldTxt = Number.isFinite(bestOld) ? formatEUR(bestOld) : ""

        const pct = x.bestSale && Number.isFinite(x.bestSale.pct) ? x.bestSale.pct : null

        const primarySource =
          (x.bestSale && x.bestSale.source) ? x.bestSale.source
          : (x.best && x.best.source) ? x.best.source
          : "alternate"

        const sL = x.sources ? x.sources.lego : null
        const sA = x.sources ? x.sources.amazon : null
        const sAlt = x.sources ? x.sources.alternate : null

        const detailsHtml =
          "<div class=\"details\">" +
            "<div class=\"stores\">" +
              storeBtnHtml("LEGO", sL, primarySource === "lego") +
              storeBtnHtml("Amazon", sA, primarySource === "amazon") +
              storeBtnHtml("Alternate", sAlt, primarySource === "alternate") +
            "</div>" +
          "</div>"

        const card = document.createElement("div")
        card.className = "card"
        card.innerHTML =
          "<div class=\"thumb\">" +
            "<img loading=\"lazy\" src=\"" + escapeHtml(img) + "\" alt=\"" + escapeHtml(name) + "\" onerror=\"this.onerror=null;this.src='" + FALLBACK_IMG + "'\">" +
            topBadgeHtml(x) +
            "<button class=\"remove\" type=\"button\" aria-label=\"Remove\" data-key=\"" + escapeHtml(x.key) + "\">×</button>" +
          "</div>" +
          "<div class=\"body\">" +
            "<div class=\"name\">" + escapeHtml(name) + "</div>" +
            "<div class=\"topline\">" +
              "<div class=\"setno\">" + (setNumber ? ("Set " + escapeHtml(setNumber)) : "Kein Set") + "</div>" +
              "<div class=\"pricebox\">" +
                (pct ? "<div class=\"pctpill\">-" + escapeHtml(String(pct)) + "%</div>" : "") +
                (oldTxt ? "<div class=\"oldprice\">" + escapeHtml(oldTxt) + "</div>" : "") +
                "<div class=\"price\">" + escapeHtml(priceTxt) + "</div>" +
              "</div>" +
            "</div>" +
            "<button class=\"toggle\" type=\"button\">Shops öffnen</button>" +
            detailsHtml +
          "</div>"

        const removeBtn = card.querySelector(".remove")
        removeBtn.addEventListener("click", (e) => {
          e.stopPropagation()
          const k = removeBtn.getAttribute("data-key")
          const kset = loadKeys()
          const kitems = loadItems()
          kset.delete(k)
          delete kitems[k]
          save(kset, kitems)
          render()
        })

        const toggle = card.querySelector(".toggle")
        toggle.addEventListener("click", (e) => {
          e.stopPropagation()
          const willOpen = !card.classList.contains("expanded")
          document.querySelectorAll(".card.expanded").forEach(c => { if(c !== card) c.classList.remove("expanded") })
          if(willOpen) card.classList.add("expanded")
          else card.classList.remove("expanded")
          if(willOpen) card.scrollIntoView({ block:"nearest", behavior:"smooth" })
        })

        card.querySelectorAll(".store-btn").forEach(btn => {
          btn.addEventListener("click", (e) => {
            e.stopPropagation()
            const url = btn.getAttribute("data-url") || ""
            if(url) window.open(url, "_blank", "noopener")
          })
        })

        card.addEventListener("click", () => {
          const willOpen = !card.classList.contains("expanded")
          document.querySelectorAll(".card.expanded").forEach(c => { if(c !== card) c.classList.remove("expanded") })
          if(willOpen) card.classList.add("expanded")
          else card.classList.remove("expanded")
          if(willOpen) card.scrollIntoView({ block:"nearest", behavior:"smooth" })
        })

        els.grid.appendChild(card)
      }
    }

    if(els.backBtn){
      els.backBtn.addEventListener("click", () => {
        location.href = "/sale.html"
      })
    }

    if(els.clearBtn){
      els.clearBtn.addEventListener("click", () => {
        localStorage.setItem(LS_WISH_KEYS, "[]")
        localStorage.setItem(LS_WISH_ITEMS, "{}")
        render()
      })
    }

    render()
  </script>
</body>
</html>
