<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SetHub Sale</title>
  <meta name="description" content="SetHub Sale – Deals von Amazon, LEGO, Alternate" />
  <meta name="theme-color" content="#0E141A" />
  <link rel="icon" type="image/png" href="Bilder/lagos.png" />

  <style>
    :root{
      --bg:#0E141A;
      --fg-on:#E6E9ED;
      --muted:#9AA4AE;
      --shadow:0 26px 90px rgba(0,0,0,.55);
      --r2:23px;

      --border:#1f2a35;
      --border2:#0f1a22;

      --pink:#cf64e5;
      --cyan:#00E5FF;
    }

    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      color:var(--fg-on);
      background:var(--bg);
      overflow-x:hidden;
      min-height:100vh;
    }
    img{max-width:100%;display:block;height:auto}
    a{color:inherit;text-decoration:none}
    button,input,select{font:inherit}

    header.site{
      position:fixed;
      left:0; right:0; top:0;
      height:78px;
      background:rgba(16,24,32,.65);
      backdrop-filter:blur(10px);
      border-bottom:1px solid var(--border2);
      z-index:50;
    }

    .topbar-inner{
      height:100%;
      width:min(1240px,100%);
      margin:0 auto;
      padding:0 14px;
      display:grid;
      grid-template-columns:56px 1fr 56px;
      align-items:center;
    }

    .nav-brand{
      grid-column:2;
      justify-self:center;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:.6rem;
      min-width:0;
      transform:translateY(4px);
    }

    .logo-svg{width:100%;height:100%;display:block}

    .nav-logo{
      height:48px;
      width:auto;
      display:grid;
      place-items:center;
      transform:translateY(10px);
      flex:0 0 auto;
    }

    .nav-text{
      display:flex;
      align-items:center;
      gap:.15em;
      line-height:1;
      font-weight:900;
      letter-spacing:.04em;
      color:#fff;
      font-size:1.6rem;
      white-space:nowrap;
    }

    .burger{
      position:fixed;
      top:16px;
      left:14px;
      z-index:60;
      width:46px;
      height:46px;
      border-radius:12px;
      background:rgba(16,24,32,.7);
      border:1px solid var(--border);
      backdrop-filter:blur(10px);
      display:grid;
      place-items:center;
      cursor:pointer;
      opacity:1;
      pointer-events:auto;
      transition:transform .12s ease, filter .12s ease;
    }
    .burger:hover{transform:translateY(-1px);filter:brightness(1.06)}

    .burger .lines{width:20px;height:14px;position:relative}
    .burger .lines span{
      position:absolute;left:0;right:0;
      height:2px;background:#e8eef4;border-radius:2px;
      transition:transform .25s ease, opacity .2s ease, top .25s ease;
    }
    .burger .lines span:nth-child(1){top:0}
    .burger .lines span:nth-child(2){top:6px}
    .burger .lines span:nth-child(3){top:12px}
    body.drawer-open .burger .lines span:nth-child(1){top:6px;transform:rotate(45deg)}
    body.drawer-open .burger .lines span:nth-child(2){opacity:0}
    body.drawer-open .burger .lines span:nth-child(3){top:6px;transform:rotate(-45deg)}

    .top-links{
      position:fixed;
      top:16px;
      left:68px;
      z-index:59;
      display:flex;
      gap:10px;
      opacity:1;
      pointer-events:auto;
      transform:none;
    }

    .top-link{
      height:46px;
      padding:0 14px;
      border-radius:12px;
      background:rgba(16,24,32,.7);
      border:1px solid var(--border);
      backdrop-filter:blur(10px);
      display:flex;
      align-items:center;
      gap:10px;
      cursor:pointer;
      user-select:none;
      font-weight:800;
      color:#fff;
      letter-spacing:.02em;
      white-space:nowrap;
    }
    .top-link:hover{background:rgba(19,32,42,.85)}
    .top-link span{color:#b7c2cc;font-weight:700}

    @media (max-width:720px){
      header.site{height:72px}
      .nav-logo{height:44px}
      .nav-text{font-size:1.45rem}
      .burger{width:44px;height:44px;top:14px}
      .top-links{top:14px;left:64px;gap:8px}
      .top-link{height:44px;padding:0 12px}
      .top-link span{display:none}
    }

    @media (max-width:520px){
      .top-links{display:none}
    }

    .drawer{
      position:fixed;
      top:0; left:0; bottom:0;
      width:min(320px,86vw);
      background:rgba(12,18,24,.98);
      border-right:1px solid #16212a;
      z-index:58;
      transform:translateX(-100%);
      transition:transform .32s ease;
      display:flex;
      flex-direction:column;
      padding:90px 18px 18px;
      gap:10px;
    }
    body.drawer-open .drawer{transform:translateX(0)}

    .drawer a{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:14px 14px;
      border-radius:12px;
      background:#0f1820;
      border:1px solid #1a2530;
      font-weight:700;
      letter-spacing:.02em;
    }
    .drawer a:hover{background:#13202a}
    .drawer small{color:#94a3b8;font-weight:600}

    .drawer-backdrop{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.45);
      z-index:57;
      opacity:0;
      pointer-events:none;
      transition:opacity .25s ease;
    }
    body.drawer-open .drawer-backdrop{opacity:1;pointer-events:auto}

    main{
      padding:92px 5% 60px;
      width:min(1240px,100%);
      margin:0 auto;
    }
    @media (max-width:720px){ main{padding-top:84px} }
    @media (max-width:420px){ main{padding-inline:4%} }

    .panel{
      border-radius:var(--r2);
      background:
        radial-gradient(1200px 700px at 72% 22%, rgba(236,72,153,.22), transparent 70%),
        radial-gradient(1100px 650px at 78% 82%, rgba(59,130,246,.18), transparent 65%),
        rgba(15,22,30,.68);
      border:1px solid #223041;
      box-shadow:var(--shadow);
      padding:clamp(14px,2.2vw,20px);
    }

    .head{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
      margin-bottom:12px;
    }

    .tblock{min-width:240px}
    .title{
      font-weight:900;
      font-size:clamp(2rem,3.4vw,2.7rem);
      letter-spacing:.01em;
      line-height:1.05;
    }
    .sub{
      margin-top:8px;
      color:#cfd6dd;
      font-weight:800;
      letter-spacing:.14em;
      text-transform:uppercase;
      font-size:.85rem;
      opacity:.95;
    }

    .stats{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:flex-end;
    }
    .pill{
      border:1px solid rgba(255,255,255,.10);
      background:rgba(16,24,32,.35);
      border-radius:999px;
      padding:10px 12px;
      font-weight:900;
      display:flex;
      align-items:center;
      gap:8px;
      white-space:nowrap;
    }
    .pill span{color:var(--muted);font-weight:800}

    .controls{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      margin-top:10px;
    }

    .searchwrap{
      flex:1 1 280px;
      display:flex;
      gap:10px;
      align-items:center;
      min-width:240px;
    }

    .field{
      height:46px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(16,24,32,.42);
      color:#e8eef4;
      outline:none;
      padding:0 12px;
      font-weight:850;
      width:100%;
    }
    .field:focus{box-shadow:0 0 0 4px rgba(207,100,229,.10)}
    .field::placeholder{color:#9aa4ae}

    .iconbtn{
      height:46px;
      width:46px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(16,24,32,.42);
      display:grid;
      place-items:center;
      cursor:pointer;
      transition:transform .12s ease, filter .12s ease;
      flex:0 0 auto;
    }
    .iconbtn:hover{transform:translateY(-1px);filter:brightness(1.06)}
    .iconbtn svg{width:20px;height:20px;color:#fff}

    .filters{
      display:none;
      width:100%;
      margin-top:10px;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }
    .filters.on{display:flex}

    .btn{
      height:46px;
      border-radius:14px;
      border:1px solid rgba(207,100,229,.65);
      background:linear-gradient(180deg,#7a3bd0,#572B87);
      color:#fff;
      font-weight:900;
      cursor:pointer;
      padding:0 14px;
      transition:transform .12s ease, filter .12s ease;
    }
    .btn:hover{transform:translateY(-1px);filter:brightness(1.06)}
    .btn:disabled{opacity:.6;cursor:default;transform:none;filter:none}

    .grid{
      display:grid;
      gap:12px;
      grid-template-columns:repeat(2,minmax(0,1fr));
      margin-top:14px;
    }

    @media (min-width:700px){
      .grid{grid-template-columns:repeat(3,minmax(0,1fr))}
    }
    @media (min-width:1100px){
      .grid{grid-template-columns:repeat(5,minmax(0,1fr))}
    }

    .card{
      position:relative;
      border-radius:18px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.08);
      background:linear-gradient(180deg,#101820,#0b1218);
      box-shadow:0 18px 70px rgba(0,0,0,.55);
      cursor:pointer;
      transform:translateY(0);
      transition:transform .15s ease, border-color .15s ease, filter .15s ease;
      display:flex;
      flex-direction:column;
      min-height:320px;
    }
    .card:hover{transform:translateY(-2px);border-color:rgba(255,255,255,.16);filter:brightness(1.03)}
    .card.expanded{min-height:420px}

    .thumb{
      position:relative;
      aspect-ratio:1/1;
      background:#0b1218;
      border-bottom:1px solid rgba(255,255,255,.08);
    }
    .thumb img{width:100%;height:100%;object-fit:cover}

    .heart{
      position:absolute;
      right:10px;
      top:10px;
      height:42px;
      width:42px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(16,24,32,.45);
      display:grid;
      place-items:center;
      cursor:pointer;
      z-index:2;
      color:#e8eef4;
    }
    .heart:hover{filter:brightness(1.06)}
    .heart svg{width:20px;height:20px}
    .heart .hfill{opacity:0}
    .heart.on{border-color:rgba(207,100,229,.65);color:var(--pink)}
    .heart.on .hfill{opacity:1}

    .txt{
      padding:12px 10px 14px;
      text-align:center;
      display:flex;
      flex-direction:column;
      gap:8px;
      flex:1;
    }

    .name{
      font-weight:900;
      font-size:.98rem;
      line-height:1.2;
      display:-webkit-box;
      -webkit-line-clamp:2;
      -webkit-box-orient:vertical;
      overflow:hidden;
      min-height:2.4em;
    }

    .meta{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      margin-top:2px;
    }
    .setno{
      color:var(--muted);
      font-weight:900;
      letter-spacing:.08em;
      text-transform:uppercase;
      font-size:.78rem;
    }
    .price{
      font-weight:900;
      font-size:1.1rem;
      letter-spacing:.01em;
      color:#fff;
      white-space:nowrap;
    }

    .chips{
      display:flex;
      justify-content:center;
      gap:6px;
      flex-wrap:wrap;
      margin-top:2px;
    }
    .chip{
      border:1px solid rgba(255,255,255,.12);
      background:rgba(16,24,32,.35);
      border-radius:999px;
      padding:7px 9px;
      font-weight:900;
      font-size:.78rem;
      color:#d9e1e8;
      display:flex;
      align-items:center;
      gap:6px;
      white-space:nowrap;
    }
    .chip span{color:var(--muted);font-weight:800}
    .chip.best{border-color:rgba(0,229,255,.40)}
    .chip.best span{color:#bff7ff}
    .chip.sale{border-color:rgba(207,100,229,.65)}
    .chip.sale span{color:#f2c9ff}

    .openbtn{
      margin-top:auto;
      height:42px;
      border-radius:14px;
      border:1px solid rgba(207,100,229,.65);
      background:linear-gradient(180deg,#7a3bd0,#572B87);
      color:#fff;
      font-weight:900;
      cursor:pointer;
      width:100%;
      transition:transform .12s ease, filter .12s ease;
    }
    .openbtn:hover{transform:translateY(-1px);filter:brightness(1.06)}

    .details{
      display:none;
      margin-top:10px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(16,24,32,.28);
      border-radius:16px;
      padding:10px;
      text-align:left;
      gap:10px;
    }
    .card.expanded .details{display:grid}

    .store-row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding:10px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(16,24,32,.30);
    }

    .store-left{
      display:flex;
      flex-direction:column;
      gap:4px;
      min-width:0;
    }
    .store-name{
      font-weight:900;
      letter-spacing:.02em;
    }
    .store-sub{
      color:var(--muted);
      font-weight:850;
      font-size:.82rem;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      max-width:220px;
    }

    .store-right{
      display:flex;
      align-items:center;
      gap:10px;
      flex:0 0 auto;
    }

    .buybtn{
      height:40px;
      padding:0 12px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(16,24,32,.40);
      color:#fff;
      font-weight:900;
      cursor:pointer;
    }
    .buybtn:hover{filter:brightness(1.06)}
    .buybtn.primary{
      border-color:rgba(0,229,255,.40);
    }

    .empty{
      margin-top:14px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(16,24,32,.35);
      border-radius:18px;
      padding:14px;
      color:#cfd6dd;
      font-weight:850;
      line-height:1.5;
      text-align:center;
    }

    .pager{
      margin-top:14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }

    .pagebtn{
      height:44px;
      padding:0 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(16,24,32,.42);
      color:#fff;
      font-weight:900;
      cursor:pointer;
      transition:transform .12s ease, filter .12s ease;
    }
    .pagebtn:hover{transform:translateY(-1px);filter:brightness(1.06)}
    .pagebtn:disabled{opacity:.5;cursor:default;transform:none;filter:none}

    .pinfo{
      color:var(--muted);
      font-weight:900;
      letter-spacing:.06em;
      text-transform:uppercase;
      font-size:.8rem;
    }

    .skeleton{
      border-radius:18px;
      border:1px solid rgba(255,255,255,.08);
      background:rgba(16,24,32,.35);
      height:320px;
    }
  </style>
</head>

<body>
  <button class="burger" id="burgerBtn" aria-label="Menü öffnen" type="button">
    <div class="lines" aria-hidden="true">
      <span></span><span></span><span></span>
    </div>
  </button>

  <div class="top-links" id="topLinks" aria-label="Quick Links">
    <a class="top-link" href="/news.html" aria-label="News">
      <strong>News</strong><span>Updates</span>
    </a>
    <a class="top-link" href="/events.html" aria-label="Events">
      <strong>Events</strong><span>Dates</span>
    </a>
    <a class="top-link" href="/sale.html" aria-label="Sale">
      <strong>Sale</strong><span>Deals</span>
    </a>
  </div>

  <nav class="drawer" id="drawer" aria-label="Menü">
   <a href="/index.html" class="drawer-link">Home<small>Start</small></a>
    <a href="/news.html" class="drawer-link">News<small>Updates</small></a>
    <a href="/events.html" class="drawer-link">Events<small>Dates</small></a>
     <a href="/sale.html" class="drawer-link">Impressum<small>Legal</small></a>
    <a href="/index.html#impressum" class="drawer-link">Impressum<small>Legal</small></a>
    <button class="drawer-link" id="loginOpenDrawer" type="button">Anmelden <small>Google</small></button>
  </nav>
  <div class="drawer-backdrop" id="drawerBackdrop" aria-hidden="true"></div>

  <svg width="0" height="0" style="position:absolute;left:-9999px;top:-9999px" aria-hidden="true" focusable="false">
    <symbol id="sethub-logo" viewBox="0 0 3326 2408" preserveAspectRatio="xMidYMid meet">
      <defs>
        <g id="logo-geometry">
          <g id="Ebene_3">
            <path fill="#04d5eb" fill-rule="evenodd" d="M1421.54,318.24c22.25,62.73,139.85,77.99,200.88,77.76,17.07-.06,161.51-2.01,187.92-71.28,7.3-19.15,6.91-46.93,6.48-77.76-.45-31.95-.57-47.96-5.79-61.91-24.9-66.46-125.71-83.15-149.73-87.13-16.28-2.7-49.47-6.7-90.72,0-27.93,4.54-123.89,20.12-149.04,84.24-6.27,16-6.23,32.31-6.48,64.8-.17,22.34-.39,51.9,6.48,71.28ZM1434.5,208.08c0-48.05,91.62-90.72,184.74-90.72s178.14,42.67,178.14,90.72-91.62,97.2-184.74,97.2-178.14-49.15-178.14-97.2Z"></path>
            <path fill="#04d5eb" fill-rule="evenodd" d="M1826.54,534.24c22.25,62.73,139.85,77.99,200.88,77.76,17.07-.06,161.51-2.01,187.92-71.28,7.3-19.15,6.91-46.93,6.48-77.76-.45-31.95-.57-47.96-5.79-61.91-24.9-66.46-125.71-83.15-149.73-87.13-16.28-2.7-49.47-6.7-90.72,0-27.93,4.54-123.89,20.12-149.04,84.24-6.27,16-6.23,32.31-6.48,64.8-.17,22.34-.39,51.9,6.48,71.28ZM1839.5,424.08c0-48.05,91.62-90.72,184.74-90.72s178.14,42.67,178.14,90.72-91.62,97.2-184.74,97.2-178.14-49.15-178.14-97.2Z"></path>
            <path fill="#04d5eb" fill-rule="evenodd" d="M1421.54,799.99c22.25,62.73,139.85,77.99,200.88,77.76,17.07-.06,161.51-2.01,187.92-71.28,7.3-19.15,6.91-46.93,6.48-77.76-.45-31.95-.57-47.96-5.79-61.91-24.9-66.46-125.71-83.15-149.73-87.13-16.28-2.7-49.47-6.7-90.72,0-27.93,4.54-123.89,20.12-149.04,84.24-6.27,16-6.23,32.31-6.48,64.8-.17,22.34-.39,51.9,6.48,71.28ZM1434.5,689.83c0-48.05,91.62-90.72,184.74-90.72s178.14,42.67,178.14,90.72-91.62,97.2-184.74,97.2-178.14-49.15-178.14-97.2Z"></path>
            <path fill="#04d5eb" fill-rule="evenodd" d="M1019.52,534.24c22.25,62.73,139.85,77.99,200.88,77.76,17.07-.06,161.51-2.01,187.92-71.28,7.3-19.15,6.91-46.93,6.48-77.76-.45-31.95-.57-47.96-5.79-61.91-24.9-66.46-125.71-83.15-149.73-87.13-16.28-2.7-49.47-6.7-90.72,0-27.93,4.54-123.89,20.12-149.04,84.24-6.27,16-6.23,32.31-6.48,64.8-.17,22.34-.39,51.9,6.48,71.28ZM1032.48,424.08c0-48.05,91.62-90.72,184.74-90.72s178.14,42.67,178.14,90.72-91.62,97.2-184.74,97.2-178.14-49.15-178.14-97.2Z"></path>
          </g>
          <g id="Ebene_5">
            <path fill="#04d5eb" d="M1586,1605l-765-450v-585l765,459v576Z"></path>
            <path fill="#04d5eb" d="M1640,1605l765-450v-585l-765,459v576Z"></path>
          </g>
        </g>

        <mask id="logoMask" maskUnits="userSpaceOnUse" x="0" y="0" width="3326" height="2408">
          <use href="#logo-geometry"></use>
        </mask>

        <linearGradient id="gradA" x1="-20%" y1="0%" x2="120%" y2="0%" spreadMethod="reflect">
          <stop offset="0%">
            <animate attributeName="stop-color" dur="12s" repeatCount="indefinite"
              values="#00E5FF; #FF5EA0; #FFD300; #00FF87; #00E5FF"></animate>
          </stop>
          <stop offset="50%">
            <animate attributeName="stop-color" dur="12s" repeatCount="indefinite"
              values="#7A5CFF; #00FF87; #FF5EA0; #00E5FF; #7A5CFF"></animate>
          </stop>
          <stop offset="100%">
            <animate attributeName="stop-color" dur="12s" repeatCount="indefinite"
              values="#FF5EA0; #FFD300; #00E5FF; #7A5CFF; #FF5EA0"></animate>
          </stop>
          <animateTransform attributeName="gradientTransform" type="translate" dur="12s"
            repeatCount="indefinite" values="-0.4 0; 0.4 0; -0.4 0"></animateTransform>
        </linearGradient>
      </defs>

      <g mask="url(#logoMask)">
        <rect x="0" y="0" width="3326" height="2408" fill="url(#gradA)"></rect>
      </g>
    </symbol>
  </svg>

  <header class="site" aria-label="Navigation">
    <div class="topbar-inner">
      <div class="nav-brand">
        <div class="nav-logo" aria-hidden="true">
          <svg class="logo-svg" viewBox="0 0 3326 2408" preserveAspectRatio="xMidYMid meet">
            <use href="#sethub-logo"></use>
          </svg>
        </div>
        <div class="nav-text" aria-label="SetHub">
          <span>S</span><span>e</span><span>t</span><span>H</span><span>u</span><span>b</span>
        </div>
      </div>
    </div>
  </header>

  <main>
    <div class="panel">
      <div class="head">
        <div class="tblock">
          <div class="title">Sale</div>
          <div class="sub">Amazon · LEGO · Alternate</div>
        </div>

        <div class="stats">
          <div class="pill"><span>Sets</span><strong id="statSets">0</strong></div>
          <div class="pill"><span>Wishlist</span><strong id="statWish">0</strong></div>
        </div>
      </div>

      <div class="controls" role="search">
        <div class="searchwrap">
          <input class="field" id="q" placeholder="Suche Name oder Set Number" autocomplete="off" />
          <button class="iconbtn" id="filterBtn" type="button" aria-label="Filter öffnen">
            <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M4 6h16M7 12h10M10 18h4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </button>
        </div>

        <button class="btn" id="reload" type="button">Reload</button>
      </div>

      <div class="filters" id="filters">
        <select class="field" id="sort" aria-label="Sortierung">
          <option value="best">Billigste zuerst</option>
          <option value="worst">Teuerste zuerst</option>
          <option value="name_az">Name A bis Z</option>
          <option value="name_za">Name Z bis A</option>
          <option value="set_asc">Set Number aufsteigend</option>
          <option value="set_desc">Set Number absteigend</option>
          <option value="sale_desc">Rabatt hoch zuerst</option>
        </select>

        <select class="field" id="source" aria-label="Quelle">
          <option value="all">Alle Quellen</option>
          <option value="amazon">Nur Amazon</option>
          <option value="lego">Nur LEGO</option>
          <option value="alternate">Nur Alternate</option>
        </select>
      </div>

      <div class="grid" id="grid" aria-label="Sale Sets">
        <div class="skeleton"></div><div class="skeleton"></div><div class="skeleton"></div><div class="skeleton"></div>
        <div class="skeleton"></div><div class="skeleton"></div><div class="skeleton"></div><div class="skeleton"></div>
        <div class="skeleton"></div><div class="skeleton"></div>
      </div>

      <div class="empty" id="empty" hidden>Keine Treffer</div>

      <div class="pager" id="pager" hidden>
        <button class="pagebtn" id="prev" type="button">Zurück</button>
        <div class="pinfo" id="pinfo">Seite 1</div>
        <button class="pagebtn" id="next" type="button">Weiter</button>
      </div>
    </div>
  </main>

  <script>
    const API = {
      amazon: "https://sethub.ddnsfree.com/SaleScraper/api/Amazon/sales",
      lego: "https://sethub.ddnsfree.com/SaleScraper/api/Lego",
      alternate: "https://sethub.ddnsfree.com/SaleScraper/api/Alternate"
    }

    const MAX_SETS = 200

    const els = {
      burgerBtn: document.getElementById("burgerBtn"),
      drawerBackdrop: document.getElementById("drawerBackdrop"),
      filterBtn: document.getElementById("filterBtn"),
      filters: document.getElementById("filters"),

      q: document.getElementById("q"),
      sort: document.getElementById("sort"),
      source: document.getElementById("source"),
      reload: document.getElementById("reload"),

      grid: document.getElementById("grid"),
      empty: document.getElementById("empty"),
      pager: document.getElementById("pager"),
      prev: document.getElementById("prev"),
      next: document.getElementById("next"),
      pinfo: document.getElementById("pinfo"),

      statSets: document.getElementById("statSets"),
      statWish: document.getElementById("statWish")
    }

    function openDrawer(){ document.body.classList.add("drawer-open") }
    function closeDrawer(){ document.body.classList.remove("drawer-open") }

    els.burgerBtn.addEventListener("click", () => {
      if(document.body.classList.contains("drawer-open")) closeDrawer()
      else openDrawer()
    })
    els.drawerBackdrop.addEventListener("click", closeDrawer)
    document.querySelectorAll(".drawer-link").forEach(a => a.addEventListener("click", closeDrawer))
    addEventListener("keydown", e => { if(e.key === "Escape") closeDrawer() })

    els.filterBtn.addEventListener("click", () => {
      els.filters.classList.toggle("on")
    })

    let PAGE_SIZE = pickPageSize()
    let raw = []
    let view = []
    let page = 1
    let wishlist = loadWishlist()

    updateWishStat()

    function pickPageSize(){
      const w = window.innerWidth || 1200
      if(w <= 520) return 10
      if(w <= 900) return 15
      return 20
    }

    function loadWishlist(){
      try{
        const x = JSON.parse(localStorage.getItem("sethub_wishlist") || "[]")
        if(Array.isArray(x)) return new Set(x.map(String))
        return new Set()
      }catch{
        return new Set()
      }
    }

    function saveWishlist(){
      localStorage.setItem("sethub_wishlist", JSON.stringify([...wishlist]))
      updateWishStat()
    }

    function updateWishStat(){
      els.statWish.textContent = String(wishlist.size)
    }

    function parsePrice(v){
      if(v === null || v === undefined) return null
      if(typeof v === "number" && isFinite(v)) return v
      const s = String(v).replace(",", ".").replace(/[^\d.]/g, "")
      const n = Number(s)
      return isFinite(n) ? n : null
    }

    function formatEUR(n){
      try{
        return new Intl.NumberFormat("de-DE", { style:"currency", currency:"EUR" }).format(n)
      }catch{
        return (Math.round(n * 100) / 100).toFixed(2) + " €"
      }
    }

    function calcDiscountPercent(price, oldPrice){
      if(!isFinite(price) || !isFinite(oldPrice)) return null
      if(oldPrice <= 0) return null
      if(oldPrice <= price) return null
      const pct = (1 - (price / oldPrice)) * 100
      if(!isFinite(pct) || pct <= 0) return null
      return Math.round(pct)
    }

    function cleanSetNumber(v){
      const s = String(v ?? "").trim()
      if(!s) return ""
      if(s === "0") return ""
      return s
    }

    function guessLegoSetNumberFromText(s){
      const m = String(s || "").match(/\b\d{4,6}\b/)
      return m ? m[0] : ""
    }

    function guessSetNumberFromUrl(u){
      const s = String(u || "")
      const m = s.match(/(?:\/|product\/)(\d{4,6})(?:\D|$)/)
      if(m && m[1]) return m[1]
      const m2 = s.match(/\b(\d{4,6})\b/)
      return m2 ? m2[1] : ""
    }

    function firstText(o, keys){
      for(const k of keys){
        const v = o && o[k]
        if(v !== undefined && v !== null && String(v).trim() !== "") return String(v)
      }
      return ""
    }

    function ensureArrayFromApi(data){
      if(Array.isArray(data)) return data
      if(data && Array.isArray(data.$values)) return data.$values
      if(data && Array.isArray(data.items)) return data.items
      if(data && Array.isArray(data.data)) return data.data
      if(data && Array.isArray(data.results)) return data.results
      if(data && Array.isArray(data.value)) return data.value
      if(data && typeof data === "object") return [data]
      return []
    }

    function normItem(source, item){
      const it = item || {}

      const name = firstText(it, ["name","title","setName","productName","product","headline","description"])
      const url = firstText(it, ["url","link","productUrl","href","detailUrl","page"])
      const image = firstText(it, ["imageUrl","image","img","image_url","thumbnail","thumb","picture","photo"])

      const price = firstText(it, ["price","currentPrice","salePrice","now","value","bestPrice","lowestPrice"])
      const oldPrice = firstText(it, ["originalPrice","oldPrice","wasPrice","regularPrice","listPrice","before","msrp"])

      let setNumber = ""
      setNumber =
        cleanSetNumber(it.setNumber) ||
        cleanSetNumber(it.setnumber) ||
        cleanSetNumber(it.set_no) ||
        cleanSetNumber(it.setNo) ||
        cleanSetNumber(it.number) ||
        cleanSetNumber(it.set) ||
        cleanSetNumber(it.setId)

      if(!setNumber) setNumber = cleanSetNumber(guessSetNumberFromUrl(url))
      if(!setNumber) setNumber = guessLegoSetNumberFromText(name)

      const p = parsePrice(price)
      const op = parsePrice(oldPrice)

      return {
        source,
        setNumber,
        name: String(name || "").trim(),
        url: String(url || "").trim(),
        image: String(image || "").trim(),
        price: p,
        oldPrice: op,
        discountPct: calcDiscountPercent(p, op)
      }
    }

    function mergeBySetNumber(list){
      const map = new Map()

      for(const x of list){
        if(x.price === null) continue

        const key = x.setNumber
          ? "set:" + x.setNumber
          : "fallback:" + (x.url || x.name || "").slice(0,180)

        const cur = map.get(key) || {
          setNumber: x.setNumber || "",
          name: x.name || "",
          sources: {},
          best: null,
          bestSale: null
        }

        if(!cur.name && x.name) cur.name = x.name

        cur.sources[x.source] = {
          price: x.price,
          oldPrice: x.oldPrice,
          discountPct: x.discountPct,
          url: x.url,
          image: x.image,
          name: x.name
        }

        if(!cur.best || x.price < cur.best.price){
          cur.best = { source:x.source, price:x.price, url:x.url }
        }

        if(x.discountPct !== null){
          if(!cur.bestSale || x.discountPct > cur.bestSale.pct){
            cur.bestSale = { source:x.source, pct:x.discountPct, price:x.price, oldPrice:x.oldPrice }
          }
        }

        map.set(key, cur)
      }

      return [...map.values()]
    }

    async function fetchJson(url){
      const res = await fetch(url, {
        method:"GET",
        mode:"cors",
        cache:"no-store",
        headers:{ "Accept":"application/json" }
      })
      if(!res.ok) throw new Error("bad status " + res.status)
      return await res.json()
    }

    async function fetchSource(source, url){
      const data = await fetchJson(url)
      const arr = ensureArrayFromApi(data)
      return arr.map(it => normItem(source, it)).filter(x => x.name || x.url || x.setNumber)
    }

    function escapeHtml(str){
      return String(str)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;")
    }

    function sourceLabel(source){
      if(source === "amazon") return "Amazon"
      if(source === "lego") return "LEGO"
      return "Alternate"
    }

    function pickCardName(x){
      const order = ["lego","amazon","alternate"]
      for(const k of order){
        const s = x.sources[k]
        if(s && s.name) return s.name
      }
      return x.name || "Set"
    }

    function pickCardImage(x){
      const order = ["lego","amazon","alternate"]
      for(const k of order){
        const s = x.sources[k]
        if(s && s.image) return s.image
      }
      return ""
    }

    function chipHtml(source, x){
      const s = x.sources[source]
      if(!s || !isFinite(s.price)) return ""
      const cls = "chip" + (x.best && source === x.best.source ? " best" : "")
      return "<div class=\"" + cls + "\">" +
        escapeHtml(sourceLabel(source)) +
        "<span>" + escapeHtml(formatEUR(s.price)) + "</span>" +
      "</div>"
    }

    function saleChipHtml(x){
      if(!x.bestSale) return ""
      const label = x.bestSale.source === "lego" || x.bestSale.source === "amazon"
        ? "Sale"
        : "Sale"

      return "<div class=\"chip sale\">" +
        escapeHtml(label) +
        "<span>" + escapeHtml(String(x.bestSale.pct)) + "%</span>" +
      "</div>"
    }

    function storeRowHtml(source, s, primary){
      if(!s || !s.url || !isFinite(s.price)) return ""
      const pct = isFinite(s.discountPct) ? s.discountPct : null
      const oldTxt = isFinite(s.oldPrice) ? formatEUR(s.oldPrice) : ""
      const sub = pct ? (formatEUR(s.price) + "  " + oldTxt + "  " + pct + "%") : formatEUR(s.price)
      return "<div class=\"store-row\" data-store=\"" + escapeHtml(source) + "\">" +
        "<div class=\"store-left\">" +
          "<div class=\"store-name\">" + escapeHtml(sourceLabel(source)) + "</div>" +
          "<div class=\"store-sub\">" + escapeHtml(sub) + "</div>" +
        "</div>" +
        "<div class=\"store-right\">" +
          "<button class=\"buybtn " + (primary ? "primary" : "") + "\" type=\"button\" data-url=\"" + escapeHtml(s.url) + "\">Open</button>" +
        "</div>" +
      "</div>"
    }

    async function loadAll(){
      els.reload.disabled = true

      try{
        const results = await Promise.allSettled([
          fetchSource("amazon", API.amazon),
          fetchSource("lego", API.lego),
          fetchSource("alternate", API.alternate)
        ])

        const all = []
        for(const r of results){
          if(r.status === "fulfilled") all.push(...r.value)
        }

        const merged = mergeBySetNumber(all)

        merged.sort((a,b)=> (a.best?.price ?? 1e18) - (b.best?.price ?? 1e18))

        raw = merged.slice(0, MAX_SETS)
        els.statSets.textContent = String(raw.length)

        page = 1
        apply()
      }catch{
        raw = []
        view = []
        render()
      }finally{
        els.reload.disabled = false
      }
    }

    function apply(){
      const q = (els.q.value || "").trim().toLowerCase()
      const s = els.source.value
      const sort = els.sort.value

      let out = raw

      if(s !== "all"){
        out = out.filter(x => x.sources[s] && isFinite(x.sources[s].price))
      }

      if(q){
        out = out.filter(x => {
          const n = (pickCardName(x) || "").toLowerCase()
          const id = (x.setNumber || "").toLowerCase()
          return n.includes(q) || id.includes(q)
        })
      }

      out = out.slice()

      if(sort === "best"){
        out.sort((a,b)=> (a.best?.price ?? 1e18) - (b.best?.price ?? 1e18))
      }else if(sort === "worst"){
        out.sort((a,b)=> (b.best?.price ?? -1) - (a.best?.price ?? -1))
      }else if(sort === "name_az"){
        out.sort((a,b)=> (pickCardName(a) || "").localeCompare((pickCardName(b) || ""), "de", { sensitivity:"base" }))
      }else if(sort === "name_za"){
        out.sort((a,b)=> (pickCardName(b) || "").localeCompare((pickCardName(a) || ""), "de", { sensitivity:"base" }))
      }else if(sort === "set_asc"){
        out.sort((a,b)=> (a.setNumber || "").localeCompare((b.setNumber || ""), "de", { numeric:true }))
      }else if(sort === "set_desc"){
        out.sort((a,b)=> (b.setNumber || "").localeCompare((a.setNumber || ""), "de", { numeric:true }))
      }else if(sort === "sale_desc"){
        out.sort((a,b)=> (b.bestSale?.pct ?? -1) - (a.bestSale?.pct ?? -1))
      }

      view = out
      render()
    }

    function render(){
      const total = view.length
      const pages = Math.max(1, Math.ceil(total / PAGE_SIZE))
      page = Math.min(page, pages)

      const start = (page - 1) * PAGE_SIZE
      const items = view.slice(start, start + PAGE_SIZE)

      els.grid.innerHTML = ""
      els.empty.hidden = items.length !== 0

      els.pager.hidden = total <= PAGE_SIZE
      els.prev.disabled = page <= 1
      els.next.disabled = page >= pages
      els.pinfo.textContent = "Seite " + page + " von " + pages

      for(const x of items){
        const name = pickCardName(x)
        const img = pickCardImage(x)
        const setNumber = x.setNumber || ""

        const bestPrice = x.best?.price
        const priceTxt = isFinite(bestPrice) ? formatEUR(bestPrice) : "-"

        const card = document.createElement("div")
        card.className = "card"
        card.tabIndex = 0
        card.setAttribute("role","group")
        card.setAttribute("aria-label", name)

        const heartKey = setNumber ? setNumber : ("fallback:" + ((x.best && x.best.url) || name))
        const heartOn = wishlist.has(heartKey)

        const sL = x.sources.lego || null
        const sA = x.sources.amazon || null
        const sAlt = x.sources.alternate || null

        const primarySource =
          (x.bestSale && (x.bestSale.source === "lego" || x.bestSale.source === "amazon"))
            ? x.bestSale.source
            : (x.best ? x.best.source : "alternate")

        const detailsHtml =
          "<div class=\"details\" role=\"group\" aria-label=\"Details\">" +
            storeRowHtml("lego", sL, primarySource === "lego") +
            storeRowHtml("amazon", sA, primarySource === "amazon") +
            storeRowHtml("alternate", sAlt, primarySource === "alternate") +
          "</div>"

        card.innerHTML =
          "<div class=\"thumb\">" +
            "<img loading=\"lazy\" src=\"" + escapeHtml(img || "/Bilder/real1.png") + "\" alt=\"" + escapeHtml(name) + "\" onerror=\"this.onerror=null;this.src='/Bilder/real1.png'\">" +
            "<button class=\"heart " + (heartOn ? "on" : "") + "\" type=\"button\" aria-label=\"Wishlist\">" +
              "<svg viewBox=\"0 0 24 24\" aria-hidden=\"true\">" +
                "<path d=\"M12 21s-7-4.6-9.3-9C1.3 9 3.2 6 6.5 6c1.9 0 3.2 1 3.9 2c.7-1 2-2 3.9-2C17.6 6 19.5 9 21.3 12c-2.3 4.4-9.3 9-9.3 9Z\" fill=\"currentColor\" class=\"hfill\"/>" +
                "<path d=\"M12 21s-7-4.6-9.3-9C1.3 9 3.2 6 6.5 6c1.9 0 3.2 1 3.9 2c.7-1 2-2 3.9-2C17.6 6 19.5 9 21.3 12c-2.3 4.4-9.3 9-9.3 9Z\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linejoin=\"round\"/>" +
              "</svg>" +
            "</button>" +
          "</div>" +
          "<div class=\"txt\">" +
            "<div class=\"name\">" + escapeHtml(name) + "</div>" +
            "<div class=\"meta\">" +
              "<div class=\"setno\">" + (setNumber ? ("Set " + escapeHtml(setNumber)) : "Kein Set") + "</div>" +
              "<div class=\"price\">" + escapeHtml(priceTxt) + "</div>" +
            "</div>" +
            "<div class=\"chips\">" +
              saleChipHtml(x) +
              chipHtml("lego", x) +
              chipHtml("amazon", x) +
              chipHtml("alternate", x) +
            "</div>" +
            "<button class=\"openbtn\" type=\"button\">Open Deal</button>" +
            detailsHtml +
          "</div>"

        const heart = card.querySelector(".heart")
        heart.addEventListener("click", (e) => {
          e.stopPropagation()
          if(wishlist.has(heartKey)) wishlist.delete(heartKey)
          else wishlist.add(heartKey)
          heart.classList.toggle("on")
          saveWishlist()
        })

        const openBtn = card.querySelector(".openbtn")
        openBtn.addEventListener("click", (e) => {
          e.stopPropagation()
          card.classList.toggle("expanded")
        })

        card.querySelectorAll(".buybtn").forEach(btn => {
          btn.addEventListener("click", (e) => {
            e.stopPropagation()
            const url = btn.getAttribute("data-url") || ""
            if(url) window.open(url, "_blank", "noopener")
          })
        })

        card.addEventListener("keydown", (e) => {
          if(e.key === "Enter"){
            e.preventDefault()
            card.classList.toggle("expanded")
          }
        })

        els.grid.appendChild(card)
      }
    }

    function debounce(fn, ms){
      let t = 0
      return (...args) => {
        clearTimeout(t)
        t = setTimeout(() => fn(...args), ms)
      }
    }

    els.prev.addEventListener("click", () => {
      page = Math.max(1, page - 1)
      render()
      window.scrollTo({ top:0, behavior:"smooth" })
    })

    els.next.addEventListener("click", () => {
      page = page + 1
      render()
      window.scrollTo({ top:0, behavior:"smooth" })
    })

    els.sort.addEventListener("change", () => { page = 1; apply() })
    els.source.addEventListener("change", () => { page = 1; apply() })
    els.q.addEventListener("input", debounce(() => { page = 1; apply() }, 140))
    els.reload.addEventListener("click", loadAll)

    window.addEventListener("resize", debounce(() => {
      const n = pickPageSize()
      if(n !== PAGE_SIZE){
        PAGE_SIZE = n
        page = 1
        render()
      }
    }, 250))

    loadAll()
  </script>
</body>
</html>
